<!DOCTYPE html> <html lang="en"> <head><!-- Primary Meta Tags --><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta name="title" content="Automated email signatures for aliases in aerc"><meta name="description" content="Pick signatures automatically when composing email or replying based on tempalte queries."><meta name="robots" content="all"><!-- browser tab title --><title>tjex • Automated email signatures for aliases in aerc</title><!-- RSS --><link rel="alternate" type="application/rss+xml" title="Tillman Jex : tjex.net" href="https://tjex.net/rss.xml"><!-- Canonical --><link rel="canonical" href="https://tjex.net/hacks/aerc-automated-signature-selection/"><!-- Favicons --><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="48x48" href="/favicon/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://tjex.net/hacks/aerc-automated-signature-selection/"><meta property="og:title" content="Automated email signatures for aliases in aerc"><meta property="og:description" content="Pick signatures automatically when composing email or replying based on tempalte queries."><meta property="og:image" content="https://tjex.net/img/profile-square.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://tjex.net/hacks/aerc-automated-signature-selection/"><meta property="twitter:title" content="Automated email signatures for aliases in aerc"><meta property="twitter:description" content="Pick signatures automatically when composing email or replying based on tempalte queries."><meta property="twitter:image" content="https://tjex.net/img/profile-square.jpg"> <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Automated email signatures for aliases in aerc","url":"https://tjex.net/blog/aerc-automated-signature-selection","datePublished":"Sat Apr 27 2024 20:06:39 GMT+0200 (Central European Summer Time)","description":"Pick signatures automatically when composing email or replying based on tempalte queries.","author":{"@type":"Person","name":"tjex","image":{"@type":"ImageObject","url":"https://tjex.net/img/profile-square.jpg","width":488,"height":488},"url":"https://tjex.net","sameAs":["https://tjex.net/blog","undefined","undefined"]},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tjex.net/blog/"}}</script> <link rel="stylesheet" href="/_astro/_page_.BrpWBfjJ.css">
<style>#themeToggle[data-astro-cid-lfoluaxz]{width:70px;height:70px;flex:0 0 auto}
</style><script type="module" src="/_astro/hoisted.Dn1LBlWI.js"></script></head> <div class="wrapper"> <div class="header-wrapper"> <div class="header-left"> <a class="nav-link site-heading" href="/">tjex</a> </div><div class="header-right"> <button class="no-outline" id="themeToggle" aria-label="theme toggle" data-astro-cid-lfoluaxz> <svg id="icon-toggle" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 120 120" width="40" height="40" xml:space="preserve" data-astro-cid-lfoluaxz> <g data-astro-cid-lfoluaxz> <path d="M60,16.005c0,0,0.001,19.736,0.001,43.994c0,24.258-0.001,43.995-0.001,43.995c-24.258,0-43.994-19.736-43.994-43.995
            C16.006,35.742,35.742,16.005,60,16.005 M60,5.005C29.627,5.005,5.006,29.626,5.006,60c0,30.372,24.622,54.995,54.994,54.995
            S114.995,90.371,114.995,60C114.995,29.626,90.372,5.005,60,5.005L60,5.005z" data-astro-cid-lfoluaxz></path> </g> </svg> </button>  <!--
is:inline includes the script directly into the page, instead 
of budling it separately (Astro specific). This decreases load 
time, which is important here to avoid theme flashing
--> <script>
  const themeToggle = document.getElementById("themeToggle");
  const getTheme = () => localStorage.getItem("theme") || "dark";
  const setTheme = (theme) => {
    localStorage.setItem("theme", theme);
    document.documentElement.dataset.theme = theme;
    document.body.classList.add(theme);
  };

  // add the current theme from local storage to DOM, which 
  // happens BEFORE rendering.
  setTheme(getTheme())  

  themeToggle.addEventListener("click", () => {
    if (getTheme() == "light") {
      setTheme("dark");
    } else {
      setTheme("light");
    }
  });
</script> </div> <div class="header-center"></div>  </div> <aside class="aside sidebar-left"> <nav class="nav-left"> <ul> <li><a class="nav-link" href="/blog">blog</a></li> <li><a class="nav-link" href="/hacks">hacks</a></li> <li><a class="nav-link" href="/projects">projects</a></li> <li><a class="nav-link" href="/listening">listening</a></li> <li><a class="nav-link" href="/contact">contact</a></li> </ul> </nav> </aside> <main class="main-content">       <article class="post-content__article"> <h1>Automated email signatures for aliases in aerc</h1> <p class="post-info"> <span>Tillman Jex, <time>April 27, 2024</time></span><br> <span class="secondary">Tagged: </span> <a href="/tags/terminal">terminal</a>
            <span>, </span><a href="/tags/dotfiles">dotfiles</a>
            <span></span> <br> <span class="secondary">License: </span> <a href="https://mit-license.org/" target="_blank" rel="noopener noreferrer">
MIT
</a> <br> <!-- if the post has been modified since original publication -->  <br> <!-- for posts that refer to computer programs used -->  </p>  <p>Within the <code>accounts.conf</code> of <a href="https://git.sr.ht/~rjarry/aerc">Aerc</a>, there is a
<code>signature-file</code> and a <code>signature-cmd</code> option. <code>signature-file</code> imports the text
content of a file as the signature for emails, while <code>signature-cmd</code> executes a
designated script with <code>sh -c</code>.</p>
<p>However, if you have email aliases, you may also want to use different
signatures depending on the alias in question (or to simply not use a signature
at all).</p>
<h2 id="solution">Solution</h2>
<p>The directory structure <code>~/.config/aerc/</code> as reference:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>aerc/</span></span>
<span class="line"><span>├── accounts.conf</span></span>
<span class="line"><span>├── aerc.conf</span></span>
<span class="line"><span>├── binds.conf</span></span>
<span class="line"><span>├── notmuch.qmap</span></span>
<span class="line"><span>├── scripts</span></span>
<span class="line"><span>│   └── sig-picker.sh</span></span>
<span class="line"><span>├── sigs</span></span>
<span class="line"><span>│   ├── tillmanx.txt</span></span>
<span class="line"><span>│   └── tjex.txt</span></span>
<span class="line"><span>├── stylesets</span></span>
<span class="line"><span>│   ├── default</span></span>
<span class="line"><span>│   └── tjex</span></span>
<span class="line"><span>└── templates</span></span>
<span class="line"><span>    ├── new-msg</span></span>
<span class="line"><span>    └── reply-quoted</span></span>
<span class="line"><span></span></span></code></pre>
<p>The following solution picks a signature based on the address in the “from”
header of an email. This solution also works for composing emails (not just
replying).</p>
<p>So it looks like this:
<code>new mail or reply -> "from" address gets piped to script -> script returns desired signature to the message body</code></p>
<h2 id="account-conf">Account conf</h2>
<p>Setting the <code>aliases</code> option in <code>accounts.conf</code> allows <code>aerc</code> to populate the
“from” field of emails that you receive at that address.</p>
<blockquote>
<p>Unrelated, but setting aliases also allows sending from those aliases with the
<code>output = msmtp --read-envelope-from</code> option ✨</p>
</blockquote>
<p><code>aerc/accounts.conf</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[account name]</span></span>
<span class="line"><span>source          = maildir://~/.local/share/mail/foo@email.com/</span></span>
<span class="line"><span>from            = Tillman X &#x3C;foo@bar.com></span></span>
<span class="line"><span>...             = ...</span></span>
<span class="line"><span>aliases         = tjex@tjex.net &#x3C;- that's the important bit here</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="template">Template</h2>
<p>First we customise the default <code>new_message</code> template slightly. Originally:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>X-Mailer: aerc {{version}}</span></span>
<span class="line"><span>{{- with .Signature }}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>{{.}}</span></span>
<span class="line"><span>{{- end -}}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<p>The edited template at <code>aerc/templates/new-msg</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>X-Mailer: aerc {{version}}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>{{if .From}}</span></span>
<span class="line"><span>{{exec `~/.config/aerc/scripts/sig-picker.sh` (index .From 0).Address}}</span></span>
<span class="line"><span>{{else}}</span></span>
<span class="line"><span></span></span></code></pre>
<p>I.e. If a “from” address is found, pipe it to <code>sig-picker.sh</code>. The
<code>{{if .From}}...{{else}}</code> is because aerc uses the <code>new_message</code> template for
replies <em>and</em> new messages. If we set this template in <code>aerc.conf</code> as the
default new message template, it will fail when composing a new email with an
<code>index out of range</code> error. But I have a way of getting around this too (in a
sec).</p>
<p>Similarly, <code>reply-quoted</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>X-Mailer: aerc {{version}}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>On {{dateFormat (.OriginalDate | toLocal) "Mon Jan 2, 2006 at 3:04 PM MST"}}, {{.OriginalFrom | names | join ", "}} wrote:</span></span>
<span class="line"><span>{{trimSignature .OriginalText | quote}}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>{{exec `~/.config/aerc/scripts/sig-picker.sh` (index .From 0).Address}}</span></span>
<span class="line"><span></span></span></code></pre>
<p>We don’t need the if statement here because this template is only ever used when
replying, in which case there will always be a from address to be found.</p>
<h2 id="bash-script">Bash script</h2>
<p><code>aerc/scripts/sig-picker.sh</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">read</span><span style="color:#9ECBFF"> input</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> [[ $input </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> "my@email.com"</span><span style="color:#E1E4E8"> ]]; </span><span style="color:#F97583">then</span></span>
<span class="line"><span style="color:#B392F0">    cat</span><span style="color:#9ECBFF"> ~/.config/aerc/sigs/tillmanx.txt</span></span>
<span class="line"><span style="color:#F97583">elif</span><span style="color:#E1E4E8"> [[ $input </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> "tjex@tjex.net"</span><span style="color:#E1E4E8"> ]]; </span><span style="color:#F97583">then</span></span>
<span class="line"><span style="color:#B392F0">    cat</span><span style="color:#9ECBFF"> ~/.config/aerc/sigs/tjex.txt</span></span>
<span class="line"><span style="color:#F97583">fi</span></span>
<span class="line"></span></code></pre>
<h2 id="signature-file-example">Signature file example</h2>
<p><code>aerc/sigs/tjex.txt</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>--</span></span>
<span class="line"><span>Tillman Jex</span></span>
<span class="line"><span>www.tjex.net</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<blockquote>
<p>note: valid email signatures need to have one white space after the delimiters
<code>-- |</code>. See <code>man aerc-accounts</code>.</p>
</blockquote>
<h2 id="implementing-in-config">Implementing in config</h2>
<p><code>aerc/aerc.conf</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[templates]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>new-message=new-msg</span></span>
<span class="line"><span>quoted-reply=reply-quoted</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now <code>:reply</code> and <code>:reply -q</code> should “work”; meaning, a specific signature will
be selected depending on which email address is filled in the “from” header when
you’re replying (i.e. one of your account aliases). This is provided that
aliases have been set up properly; if you send an email to an alias, that alias
should be automatically present in the “from” field upon replying.</p>
<p>For getting the right signature into a new email (i.e. not a reply):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[messages]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mx = :compose -H "From: Tillman Jex \&#x3C;tjex@tjex.net\>"&#x3C;enter></span></span>
<span class="line"><span></span></span></code></pre>
<p>This initialises the from header, meaning there is a “from” field which
satisfies the <code>{{if .From}}...</code> statement in the <code>new-msg</code> template.</p>
<p>I wish I could also point to my dotfiles on this one, but I don’t like having
all my emails so out in the open…</p> <hr> <div class="neighbourPost"> <a class="prevPost" href="/hacks/neovim-vertical-window-splits-by-default-with-exceptions"> Vertical window splits by default, with exceptions </a> <a class="nextPost" href="/hacks/neovim-using-pre-commit-and-gitleaks-with-dotfiles"> Catching secrets in bare git repos using gitleaks and hooks </a> </div>  </article>    </main> <aside class="aside sidebar-right"></aside> <div class="footer">
Built with <a href="https://astro.build">Astro</a> and <a href="https://picocss.com">Pico CSS</a> •
<a href="/privacy">Privacy</a> • <a href="/rss.xml" rel="me">RSS</a> </div> </div> </html>