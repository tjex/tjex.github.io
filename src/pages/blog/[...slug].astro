---
// this file generates the blog posts.

import Layout from "../../layouts/Post.astro";
import { Image } from "astro:assets";
import * as colUtil from "../../scripts/collectionUtil.ts";

// Generate a new path for every blog post
// and get previous and next posts
export async function getStaticPaths() {
    const posts = await colUtil.noDrafts("blog");
    const numberOfPosts = posts.length;

    const postsSortedByDate = posts.sort(
        (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate),
    );
    return postsSortedByDate.map((post: any, i) => ({
        params: { slug: post.slug },
        props: {
            post,
            // Previous post
            prevPost:
                i + 1 === numberOfPosts // If the current post is the oldest
                    ? { frontmatter: "" }
                    : posts[i + 1],
            // Next post
            nextPost:
                i === 0 // If the current post is the newest
                    ? { frontmatter: "" }
                    : posts[i - 1],
        },
    }));
}

const { post, prevPost, nextPost } = Astro.props;
const { Content } = await post.render();

const seoTitle = post.data.title;
const seoDescription = post.data.description;

const seo = {
    title: seoTitle,
    description: seoDescription,
};
---

<Layout seo={seo} post={post}>
    <!-- only display image if there is one -->
    {
        post.data.image && (
            <Image src={post.data.image.src} alt={post.data.image.alt} />
        )
    }
    {prevPost.slug}
    <Content />
</Layout>
