---
// Lists pages with tag x
import Layout from "../../layouts/Page.astro";
import BlogPostPreview from "../../components/BlogPostPreview.astro";
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  
  const uniqueTags = [...new Set(posts.map((post) => post.data.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = posts
    .filter((post) => post.data.tags.includes(tag))
    .map(({ data, url, slug }) => ({
        url: url,
        slug: slug,
        title: data.title,
        description: data.description,
        pubDate: data.pubDate,
        cover: data.cover,
        coverAlt: data.coverAlt,
      }));
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}


const { tag } = Astro.params;
const { posts } = Astro.props;

const seoTitle = tag;
const seo = {
  title: seoTitle,
  description: `All posts tagged with ${seoTitle} on tjex.net`
}
---


<Layout seo={seo}>
    <h1>{tag}</h1>
    <p>Posts tagged with <span class="bubble" >{tag}</a></p>
    <article class="blog-page-content__article">
      <section class="postlist">
        { posts.map((post: any) => <BlogPostPreview post={post} />) }
      </section>
    </article>
</Layout>

